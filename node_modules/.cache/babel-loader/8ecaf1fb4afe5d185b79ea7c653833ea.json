{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst constants_1 = require(\"../constants\");\n\nconst helpers_1 = require(\"../helpers\");\n\nconst fallback_1 = require(\"./fallback\");\n\nfunction getBrowerCrypto() {\n  var _a, _b;\n\n  return ((_a = global) === null || _a === void 0 ? void 0 : _a.crypto) || ((_b = global) === null || _b === void 0 ? void 0 : _b.msCrypto) || {};\n}\n\nexports.getBrowerCrypto = getBrowerCrypto;\n\nfunction getSubtleCrypto() {\n  const browserCrypto = getBrowerCrypto();\n  return browserCrypto.subtle || browserCrypto.webkitSubtle;\n}\n\nexports.getSubtleCrypto = getSubtleCrypto;\n\nfunction browserRandomBytes(length) {\n  const browserCrypto = getBrowerCrypto();\n\n  if (typeof browserCrypto.getRandomValues !== 'undefined') {\n    return helpers_1.arrayToBuffer(browserCrypto.getRandomValues(new Uint8Array(length)));\n  }\n\n  return fallback_1.fallbackRandomBytes(length);\n}\n\nexports.browserRandomBytes = browserRandomBytes;\n\nfunction browserImportKey(buffer, type = constants_1.AES_BROWSER_ALGO) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const algo = type === constants_1.AES_BROWSER_ALGO ? {\n      length: constants_1.AES_LENGTH,\n      name: constants_1.AES_BROWSER_ALGO\n    } : {\n      hash: {\n        name: constants_1.HMAC_BROWSER_ALGO\n      },\n      name: constants_1.HMAC_BROWSER\n    };\n    const ops = type === constants_1.AES_BROWSER_ALGO ? [constants_1.ENCRYPT_OP, constants_1.DECRYPT_OP] : [constants_1.SIGN_OP, constants_1.VERIFY_OP];\n    const cryptoKey = yield subtle.importKey('raw', buffer, algo, true, ops);\n    return cryptoKey;\n  });\n}\n\nexports.browserImportKey = browserImportKey;\n\nfunction browserAesEncrypt(iv, key, data) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const cryptoKey = yield browserImportKey(key, constants_1.AES_BROWSER_ALGO);\n    const result = yield subtle.encrypt({\n      iv,\n      name: constants_1.AES_BROWSER_ALGO\n    }, cryptoKey, data);\n    return Buffer.from(result);\n  });\n}\n\nexports.browserAesEncrypt = browserAesEncrypt;\n\nfunction browserAesDecrypt(iv, key, data) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const cryptoKey = yield browserImportKey(key, constants_1.AES_BROWSER_ALGO);\n    const result = yield subtle.decrypt({\n      iv,\n      name: constants_1.AES_BROWSER_ALGO\n    }, cryptoKey, data);\n    return Buffer.from(result);\n  });\n}\n\nexports.browserAesDecrypt = browserAesDecrypt;\n\nfunction browserHmacSha256Sign(key, data) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const cryptoKey = yield browserImportKey(key, constants_1.HMAC_BROWSER);\n    const signature = yield subtle.sign({\n      length: constants_1.HMAC_LENGTH,\n      name: constants_1.HMAC_BROWSER\n    }, cryptoKey, data);\n    return Buffer.from(signature);\n  });\n}\n\nexports.browserHmacSha256Sign = browserHmacSha256Sign;\n\nfunction browserHmacSha512Sign(key, data) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const cryptoKey = yield browserImportKey(key, constants_1.HMAC_BROWSER);\n    const signature = yield subtle.sign({\n      length: constants_1.LENGTH_512,\n      name: constants_1.HMAC_BROWSER\n    }, cryptoKey, data);\n    return Buffer.from(signature);\n  });\n}\n\nexports.browserHmacSha512Sign = browserHmacSha512Sign;\n\nfunction browserSha256(data) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const result = yield subtle.digest({\n      name: constants_1.SHA256_BROWSER_ALGO\n    }, data);\n    return Buffer.from(result);\n  });\n}\n\nexports.browserSha256 = browserSha256;\n\nfunction browserSha512(data) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const subtle = getSubtleCrypto();\n    const result = yield subtle.digest({\n      name: constants_1.SHA512_BROWSER_ALGO\n    }, data);\n    return Buffer.from(result);\n  });\n}\n\nexports.browserSha512 = browserSha512;","map":{"version":3,"sources":["../../../src/lib/browser.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = require(\"../constants\");\r\nconst helpers_1 = require(\"../helpers\");\r\nconst fallback_1 = require(\"./fallback\");\r\nfunction getBrowerCrypto() {\r\n    var _a, _b;\r\n    return ((_a = global) === null || _a === void 0 ? void 0 : _a.crypto) || ((_b = global) === null || _b === void 0 ? void 0 : _b.msCrypto) || {};\r\n}\r\nexports.getBrowerCrypto = getBrowerCrypto;\r\nfunction getSubtleCrypto() {\r\n    const browserCrypto = getBrowerCrypto();\r\n    return browserCrypto.subtle || browserCrypto.webkitSubtle;\r\n}\r\nexports.getSubtleCrypto = getSubtleCrypto;\r\nfunction browserRandomBytes(length) {\r\n    const browserCrypto = getBrowerCrypto();\r\n    if (typeof browserCrypto.getRandomValues !== 'undefined') {\r\n        return helpers_1.arrayToBuffer(browserCrypto.getRandomValues(new Uint8Array(length)));\r\n    }\r\n    return fallback_1.fallbackRandomBytes(length);\r\n}\r\nexports.browserRandomBytes = browserRandomBytes;\r\nfunction browserImportKey(buffer, type = constants_1.AES_BROWSER_ALGO) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const algo = type === constants_1.AES_BROWSER_ALGO\r\n            ? { length: constants_1.AES_LENGTH, name: constants_1.AES_BROWSER_ALGO }\r\n            : {\r\n                hash: { name: constants_1.HMAC_BROWSER_ALGO },\r\n                name: constants_1.HMAC_BROWSER,\r\n            };\r\n        const ops = type === constants_1.AES_BROWSER_ALGO ? [constants_1.ENCRYPT_OP, constants_1.DECRYPT_OP] : [constants_1.SIGN_OP, constants_1.VERIFY_OP];\r\n        const cryptoKey = yield subtle.importKey('raw', buffer, algo, true, ops);\r\n        return cryptoKey;\r\n    });\r\n}\r\nexports.browserImportKey = browserImportKey;\r\nfunction browserAesEncrypt(iv, key, data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const cryptoKey = yield browserImportKey(key, constants_1.AES_BROWSER_ALGO);\r\n        const result = yield subtle.encrypt({\r\n            iv,\r\n            name: constants_1.AES_BROWSER_ALGO,\r\n        }, cryptoKey, data);\r\n        return Buffer.from(result);\r\n    });\r\n}\r\nexports.browserAesEncrypt = browserAesEncrypt;\r\nfunction browserAesDecrypt(iv, key, data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const cryptoKey = yield browserImportKey(key, constants_1.AES_BROWSER_ALGO);\r\n        const result = yield subtle.decrypt({\r\n            iv,\r\n            name: constants_1.AES_BROWSER_ALGO,\r\n        }, cryptoKey, data);\r\n        return Buffer.from(result);\r\n    });\r\n}\r\nexports.browserAesDecrypt = browserAesDecrypt;\r\nfunction browserHmacSha256Sign(key, data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const cryptoKey = yield browserImportKey(key, constants_1.HMAC_BROWSER);\r\n        const signature = yield subtle.sign({\r\n            length: constants_1.HMAC_LENGTH,\r\n            name: constants_1.HMAC_BROWSER,\r\n        }, cryptoKey, data);\r\n        return Buffer.from(signature);\r\n    });\r\n}\r\nexports.browserHmacSha256Sign = browserHmacSha256Sign;\r\nfunction browserHmacSha512Sign(key, data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const cryptoKey = yield browserImportKey(key, constants_1.HMAC_BROWSER);\r\n        const signature = yield subtle.sign({\r\n            length: constants_1.LENGTH_512,\r\n            name: constants_1.HMAC_BROWSER,\r\n        }, cryptoKey, data);\r\n        return Buffer.from(signature);\r\n    });\r\n}\r\nexports.browserHmacSha512Sign = browserHmacSha512Sign;\r\nfunction browserSha256(data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const result = yield subtle.digest({\r\n            name: constants_1.SHA256_BROWSER_ALGO,\r\n        }, data);\r\n        return Buffer.from(result);\r\n    });\r\n}\r\nexports.browserSha256 = browserSha256;\r\nfunction browserSha512(data) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const subtle = getSubtleCrypto();\r\n        const result = yield subtle.digest({\r\n            name: constants_1.SHA512_BROWSER_ALGO,\r\n        }, data);\r\n        return Buffer.from(result);\r\n    });\r\n}\r\nexports.browserSha512 = browserSha512;\r\n//# sourceMappingURL=browser.js.map"]},"metadata":{},"sourceType":"script"}