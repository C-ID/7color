{"ast":null,"code":"\"use strict\";\n\nvar urilib = require('url');\n\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\n\nfunction SchemaScanResult(found, ref) {\n  this.id = found;\n  this.ref = ref;\n}\n/**\r\n * Adds a schema with a certain urn to the Validator instance.\r\n * @param string uri\r\n * @param object schema\r\n * @return {Object}\r\n */\n\n\nmodule.exports.scan = function scan(base, schema) {\n  function scanSchema(baseuri, schema) {\n    if (!schema || typeof schema != 'object') return; // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n\n    if (schema.$ref) {\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri] + 1 : 0;\n      return;\n    }\n\n    var id = schema.$id || schema.id;\n    var ourBase = id ? urilib.resolve(baseuri, id) : baseuri;\n\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if (ourBase.indexOf('#') < 0) ourBase += '#';\n\n      if (found[ourBase]) {\n        if (!helpers.deepCompareStrict(found[ourBase], schema)) {\n          throw new Error('Schema <' + ourBase + '> already exists with different definition');\n        }\n\n        return found[ourBase];\n      }\n\n      found[ourBase] = schema; // strip trailing fragment\n\n      if (ourBase[ourBase.length - 1] == '#') {\n        found[ourBase.substring(0, ourBase.length - 1)] = schema;\n      }\n    }\n\n    scanArray(ourBase + '/items', Array.isArray(schema.items) ? schema.items : [schema.items]);\n    scanArray(ourBase + '/extends', Array.isArray(schema.extends) ? schema.extends : [schema.extends]);\n    scanSchema(ourBase + '/additionalItems', schema.additionalItems);\n    scanObject(ourBase + '/properties', schema.properties);\n    scanSchema(ourBase + '/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase + '/definitions', schema.definitions);\n    scanObject(ourBase + '/patternProperties', schema.patternProperties);\n    scanObject(ourBase + '/dependencies', schema.dependencies);\n    scanArray(ourBase + '/disallow', schema.disallow);\n    scanArray(ourBase + '/allOf', schema.allOf);\n    scanArray(ourBase + '/anyOf', schema.anyOf);\n    scanArray(ourBase + '/oneOf', schema.oneOf);\n    scanSchema(ourBase + '/not', schema.not);\n  }\n\n  function scanArray(baseuri, schemas) {\n    if (!Array.isArray(schemas)) return;\n\n    for (var i = 0; i < schemas.length; i++) {\n      scanSchema(baseuri + '/' + i, schemas[i]);\n    }\n  }\n\n  function scanObject(baseuri, schemas) {\n    if (!schemas || typeof schemas != 'object') return;\n\n    for (var p in schemas) {\n      scanSchema(baseuri + '/' + p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n};","map":{"version":3,"sources":["F:/7color/node_modules/jsonschema/lib/scan.js"],"names":["urilib","require","helpers","module","exports","SchemaScanResult","found","ref","id","scan","base","schema","scanSchema","baseuri","$ref","resolvedUri","resolve","$id","ourBase","indexOf","deepCompareStrict","Error","length","substring","scanArray","Array","isArray","items","extends","additionalItems","scanObject","properties","additionalProperties","definitions","patternProperties","dependencies","disallow","allOf","anyOf","oneOf","not","schemas","i","p"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nvar urilib = require('url');\r\nvar helpers = require('./helpers');\r\n\r\nmodule.exports.SchemaScanResult = SchemaScanResult;\r\nfunction SchemaScanResult(found, ref){\r\n  this.id = found;\r\n  this.ref = ref;\r\n}\r\n\r\n/**\r\n * Adds a schema with a certain urn to the Validator instance.\r\n * @param string uri\r\n * @param object schema\r\n * @return {Object}\r\n */\r\nmodule.exports.scan = function scan(base, schema){\r\n  function scanSchema(baseuri, schema){\r\n    if(!schema || typeof schema!='object') return;\r\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\r\n    if(schema.$ref){\r\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\r\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\r\n      return;\r\n    }\r\n    var id = schema.$id || schema.id;\r\n    var ourBase = id ? urilib.resolve(baseuri, id) : baseuri;\r\n    if (ourBase) {\r\n      // If there's no fragment, append an empty one\r\n      if(ourBase.indexOf('#')<0) ourBase += '#';\r\n      if(found[ourBase]){\r\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\r\n          throw new Error('Schema <'+ourBase+'> already exists with different definition');\r\n        }\r\n        return found[ourBase];\r\n      }\r\n      found[ourBase] = schema;\r\n      // strip trailing fragment\r\n      if(ourBase[ourBase.length-1]=='#'){\r\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\r\n      }\r\n    }\r\n    scanArray(ourBase+'/items', (Array.isArray(schema.items)?schema.items:[schema.items]));\r\n    scanArray(ourBase+'/extends', (Array.isArray(schema.extends)?schema.extends:[schema.extends]));\r\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\r\n    scanObject(ourBase+'/properties', schema.properties);\r\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\r\n    scanObject(ourBase+'/definitions', schema.definitions);\r\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\r\n    scanObject(ourBase+'/dependencies', schema.dependencies);\r\n    scanArray(ourBase+'/disallow', schema.disallow);\r\n    scanArray(ourBase+'/allOf', schema.allOf);\r\n    scanArray(ourBase+'/anyOf', schema.anyOf);\r\n    scanArray(ourBase+'/oneOf', schema.oneOf);\r\n    scanSchema(ourBase+'/not', schema.not);\r\n  }\r\n  function scanArray(baseuri, schemas){\r\n    if(!Array.isArray(schemas)) return;\r\n    for(var i=0; i<schemas.length; i++){\r\n      scanSchema(baseuri+'/'+i, schemas[i]);\r\n    }\r\n  }\r\n  function scanObject(baseuri, schemas){\r\n    if(!schemas || typeof schemas!='object') return;\r\n    for(var p in schemas){\r\n      scanSchema(baseuri+'/'+p, schemas[p]);\r\n    }\r\n  }\r\n\r\n  var found = {};\r\n  var ref = {};\r\n  scanSchema(base, schema);\r\n  return new SchemaScanResult(found, ref);\r\n};\r\n"]},"metadata":{},"sourceType":"script"}